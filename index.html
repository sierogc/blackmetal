<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Black Metal</title>

<style>
body {
  margin: 0;
  min-height: 100vh;
  background-color: black;
  font-family: Arial, sans-serif;
  overflow-y: auto;
  overflow-x: hidden;
}

#text-container {
  max-width: 65%;
  margin: 5vh auto;
  font-size: 7vw;
  line-height: 1.2;
  text-align: justify;
  text-align-last: right;
  color: white;
}

@media screen and (max-width: 768px) { #text-container { max-width: 90%; font-size: 11vw; } }
@media screen and (max-width: 480px) { #text-container { max-width: 95%; font-size: 13vw; } }

.underline { text-decoration: underline; }
.italic { font-style: italic; }
.strikethrough { text-decoration: line-through; }

.highlight-red { background-color: #ff4d4d; color: black; }
.highlight-orange { background-color: #ffa64d; color: black; }
.highlight-yellow { background-color: #ffff66; color: black; }
.highlight-green { background-color: #80ff80; color: black; }
.highlight-blue { background-color: #66b3ff; color: black; }
.highlight-indigo { background-color: #9999ff; color: black; }
.highlight-violet { background-color: #e580ff; color: black; }
.highlight-white { background-color: #ffffff; color: black; }
.highlight-pink { background-color: #ff66b2; color: black; }
.highlight-cyan { background-color: #66ffff; color: black; }
.highlight-lime { background-color: #b3ff66; color: black; }
.highlight-gold { background-color: #ffd700; color: black; }

.red { color: #ff4d4d; }
.orange { color: #ffa64d; }
.yellow { color: #ffff66; }
.green { color: #80ff80; }
.blue { color: #66b3ff; }
.indigo { color: #9999ff; }
.violet { color: #e580ff; }
.white { color: #ffffff; }
.pink { color: #ff66b2; }
.cyan { color: #66ffff; }
.lime { color: #b3ff66; }
.gold { color: #ffd700; }
.magenta { color: #ff33cc; }
</style>
</head>
<body>
<div id="text-container"></div>

<script>
const originalText = "Questo è un test avanzato: le parole appariranno parola per parola, resteranno visibili, cambieranno colore ed effetto, e poi la frase si mixerà e ricomincerà.";

const textColors = ["red","orange","yellow","green","blue","indigo","violet","white","pink","cyan","lime","gold","magenta"];
const highlightColors = ["highlight-red","highlight-orange","highlight-yellow","highlight-green","highlight-blue","highlight-indigo","highlight-violet","highlight-white","highlight-pink","highlight-cyan","highlight-lime","highlight-gold"];

let container = document.getElementById("text-container");
let delay = 400;          // tempo tra una parola e l'altra nella generazione
let animationSpeed = 900; // velocità animazione ciclica
let activeTime = 10000;   // durata testo visibile
let lastColor = null;
let previousOrders = [];
let firstCycle = true;
let wordIntervals = [];

// Applica effetti casuali
function randomEffect(wordEl){
    wordEl.classList.remove(...textColors, ...highlightColors, "underline","italic","strikethrough");
    let color;
    do { color = textColors[Math.floor(Math.random() * textColors.length)]; } 
    while(color === lastColor);
    lastColor = color;
    wordEl.classList.add(color);

    let validHighlights = highlightColors.filter(h => !h.includes(color));
    const highlight = validHighlights[Math.floor(Math.random() * validHighlights.length)];
    if(highlight) wordEl.classList.add(highlight);

    const effects = ["underline","italic","strikethrough",""];
    const eff = effects[Math.floor(Math.random() * effects.length)];
    if(eff) wordEl.classList.add(eff);
}

// Genera parola per parola
function generateText(words, callback){
    container.innerHTML = "";
    wordIntervals.forEach(i => clearInterval(i));
    wordIntervals = [];
    let index = 0;

    function addWord(){
        if(index >= words.length){
            callback();
            return;
        }
        const span = document.createElement("span");
        span.textContent = words[index] + " ";
        container.appendChild(span);

        // Animazione ciclica immediata
        randomEffect(span);
        const interval = setInterval(() => randomEffect(span), animationSpeed);
        wordIntervals.push(interval);

        // Scroll automatico
        requestAnimationFrame(() => {
            if(container.scrollHeight > window.innerHeight){
                window.scrollTo({top: container.scrollHeight, behavior: "smooth"});
            }
        });

        index++;
        setTimeout(addWord, delay);
    }

    addWord();
}

// Ferma tutte le animazioni
function stopAllWordEffects(){
    wordIntervals.forEach(i => clearInterval(i));
    wordIntervals = [];
}

// Mescola array evitando ripetizioni
function shuffleArray(array){
    let newArr, alreadyUsed;
    do {
        newArr = array.slice().sort(() => Math.random() - 0.5);
        alreadyUsed = previousOrders.some(order => order.join(" ") === newArr.join(" "));
    } while(alreadyUsed);
    previousOrders.push(newArr.slice());
    return newArr;
}

// Effetto backspace: cancella parola per parola da destra verso sinistra
function deleteText(callback){
    const words = Array.from(container.querySelectorAll("span"));
    let index = words.length - 1;

    function removeWord(){
        if(index < 0){
            callback();
            return;
        }
        words[index].remove();
        index--;
        setTimeout(removeWord, delay);
    }

    removeWord();
}

// Ciclo infinito
function startCycle(){
    const words = originalText.split(" ");
    const sequence = firstCycle ? words : shuffleArray(words);
    generateText(sequence, () => {
        setTimeout(() => {
            stopAllWordEffects();
            deleteText(() => {
                firstCycle = false;
                startCycle();
            });
        }, activeTime);
    });
}

startCycle();
</script>
</body>
</html>
